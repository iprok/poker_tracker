<!doctype html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <title>Poker Stats - –¢—É—Ä–Ω–∏—Ä—ã</title>
    <script src="config.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body class="bg-gray-100 text-gray-900">
    <div class="max-w-6xl mx-auto p-4" x-data="tournamentsTable()" x-init="init()">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-bold">üèÜ –ò—Å—Ç–æ—Ä–∏—è –¢—É—Ä–Ω–∏—Ä–æ–≤</h1>
            <a href="index.html" class="text-blue-600 hover:underline">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full bg-white border border-gray-300 rounded shadow">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="p-2 text-left">ID</th>
                        <th class="p-2 text-left">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</th>
                        <th class="p-2 text-left">–°—Ç–∞—Ç—É—Å</th>
                        <th class="p-2 text-left">–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏</th>
                        <th class="p-2 text-left">–ù–∞—á–∞–ª–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                        <th class="p-2 text-left">–ù–∞—á–∞–ª–æ —Ç—É—Ä–Ω–∏—Ä–∞</th>
                        <th class="p-2 text-left">–ö–æ–Ω–µ—Ü —Ç—É—Ä–Ω–∏—Ä–∞</th>
                        <th class="p-2 text-left">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="t in tournaments" :key="t.id">
                        <tr class="border-t hover:bg-gray-50 cursor-pointer"
                            @click="window.location.href = `tournament.html?id=${t.id}`">
                            <td class="p-2">
                                <a :href="`tournament.html?id=${t.id}`" class="text-blue-600 hover:underline font-bold"
                                    x-text="t.id"></a>
                            </td>
                            <td class="p-2" x-text="t.total_players"></td>
                            <td class="p-2">
                                <span class="px-2 py-1 rounded text-xs font-bold" :class="{
                    'bg-green-100 text-green-800': t.status === 'Completed',
                    'bg-yellow-100 text-yellow-800': t.status === 'Active',
                    'bg-gray-100 text-gray-800': t.status === 'Pending'
                  }" x-text="t.statusTranslate"></span>
                            </td>
                            <td class="p-2">
                                <div class="flex flex-col gap-1 text-sm" x-html="t.winnersHtml"></div>
                            </td>
                            <td class="p-2" x-text="formatDate(t.created_at)"></td>
                            <td class="p-2" x-text="formatDate(t.start_time)"></td>
                            <td class="p-2" x-text="formatDate(t.end_time)"></td>
                            <td class="p-2" x-text="t.duration || '-'"></td>
                        </tr>
                    </template>
                </tbody>
            </table>

            <div x-show="tournaments.length === 0" class="p-4 text-center text-gray-500">
                –¢—É—Ä–Ω–∏—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
        function tournamentsTable() {
            return {
                tournaments: [],

                async init() {
                    try {
                        const data = await fetchTournaments();
                        this.tournaments = data.map(t => ({
                            ...t,
                            statusTranslate: this.translateStatus(t.status),
                            winnersHtml: (t.winners || []).map((w, i) => `<div>${['ü•á', 'ü•à', 'ü•â'][i] || ''} ${w}</div>`).join('')
                        }));
                    } catch (error) {
                        console.error("Failed to fetch tournaments:", error);
                    }
                },

                translateStatus(status) {
                    const map = {
                        'Completed': '–ó–∞–≤–µ—Ä—à–µ–Ω',
                        'Active': '–ò–¥–µ—Ç',
                        'Pending': '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤'
                    };
                    return map[status] || status;
                },

                formatDate(dateString) {
                    if (!dateString) return "-";
                    // If dateString is naive (no Z or +), assume UTC by appending Z
                    const dateValue = (dateString.endsWith('Z') || dateString.includes('+'))
                        ? dateString
                        : dateString + 'Z';
                    const date = new Date(dateValue);
                    return date.toLocaleString(undefined, {
                        year: 'numeric',
                        month: 'numeric',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }
            }
        }
    </script>
</body>

</html>